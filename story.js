// story.js

const storyTexts = {
    plotJournalEntries: [
        {
            id: "entry_001_awakening",
            title: "Пробуждение",
            text: "Я очнулся в Убежище 76. Сирены молчат, дверь запечатана. Что-то явно пошло не так. На главном терминале управления дверью, похоже, можно попытаться её открыть. Нужно осмотреться и найти способ выбраться.",
            unlocked: true
        },
        {
            id: "entry_002_first_steps",
            title: "Первые шаги в Пустоши",
            text: "Дверь Убежища открыта. Передо мной раскинулся чужой, враждебный мир. Радиометр на Pip-Boy трещит от радиации. Вдалеке виднеются руины какого-то городка. Нужно выяснить, что произошло и как выжить. Возможно, стоит поискать других выживших или какие-нибудь припасы.",
            unlocked: false
        },
        {
            id: "entry_003_springvale_contact",
            title: "Контакт в Спрингвейле",
            text: "В руинах Спрингвейла, в старом 'Супер-Дупер Марте', я встретил поселенца по имени Джо. Он рассказал немного о текущем положении дел - рейдеры, мутанты, радиация. Упомянул слухи о старой электростанции на севере, где могут быть ценные компоненты, но и повышенная опасность. Джо также попросил помочь с его радиоантенной, если я найду нужные детали.",
            unlocked: false
        },
        {
            id: "entry_004_dogmeat_found",
            title: "Верный Друг",
            text: "У старой заправки 'Красная Ракета' я нашел одинокую собаку. Она выглядела дружелюбной, и, кажется, готова следовать за мной. Возможно, вдвоем будет легче выжить в этой Пустоши.",
            unlocked: false
        },
        {
            id: "entry_005_antenna_repaired",
            title: "Сигнал Восстановлен",
            text: "Мне удалось починить радиоантенну Джо. Он был благодарен и немного рассказал о других поселениях. Кажется, установление связей в этом мире - ключ к выживанию. Джо стал более доверчив.",
            unlocked: false
        }
        // Можно добавить новые записи для расширенной истории
        // {
        //     id: "entry_006_overseer_secrets",
        //     title: "Тайны Смотрителя",
        //     text: "Терминал и сейф Смотрителя раскрыли некоторые детали о последних днях Убежища и, возможно, дали наводку на то, что произошло с автоматическим открытием двери.",
        //     unlocked: false
        // },
        // {
        //     id: "entry_007_distress_signal",
        //     title: "Сигнал Бедствия",
        //     text: "После починки антенны Джо, мы поймали слабый сигнал бедствия. Кажется, кому-то нужна помощь. Стоит проверить.",
        //     unlocked: false
        // }
    ],

    locationDescriptions: {
        getVaultEntranceHallDescription: function(isDoorOpen) {
            if (isDoorOpen) {
                return "Главный холл Убежища 76. Дверь наружу открыта, пропуская тусклый, пыльный свет Пустоши. Через неё ощущается легкий сквозняк, несущий запахи гари и запустения. Рядом все еще стоит терминал управления дверью (если он не был деактивирован).";
            } else {
                return "Вы находитесь в главном холле Убежища 76. Массивная стальная дверь наружу запечатана. Рядом стоит главный терминал управления дверью, его экран тускло светится. В углу видна дверь в комнату Смотрителя.";
            }
        },
        getWastelandNearVaultDescription: function() {
            return "Свежий, но пыльный воздух Пустоши ударяет в лицо. Вокруг руины и выжженная земля. Мир изменился до неузнаваемости. Радиометр на Pip-Boy показывает небольшой фон радиации. Вдалеке виднеются руины небольшого городка. На западе виднеется контур старой заправочной станции 'Красная Ракета'.";
        },
        getRedRocketDescription: function(dogFound, currentPlayer) {
            let desc = "Заброшенная заправочная станция 'Красная Ракета'. Все покрыто ржавчиной и пылью. Большинство оборудования разграблено, но, возможно, что-то еще осталось.";
            if (gameLocations["red_rocket_station"].customFlags.baseFoundedHere) {
                desc = "Ваша база на заправке 'Красная Ракета'. Знакомое место, где можно передохнуть и заняться делами."
            } else if (!dogFound) {
                desc += " У одной из колонок сидит одинокая немецкая овчарка и настороженно смотрит на вас.";
            } else if (currentPlayer.companion && currentPlayer.companion.id === "dogmeat") {
                desc += " Это место теперь кажется более знакомым Псине.";
            }
            return desc;
        }
    },

    npcDialogues: {
        joeTheSettler: {
            greeting: "'Еще один из Убежища? Чем могу помочь?'",
            aboutPlace: "'Это Спрингвейл... вернее, то, что от него осталось. Я тут пытаюсь выжить.'",
            tradeOffer: "'У меня мало чего есть, но можем посмотреть...'",
            wastelandInfoSuccess: "'Ох, парень... тут опасно. Рейдеры, мутанты, радиация повсюду. Держи ухо востро. Если пойдешь на север, к старой электростанции, будь особенно осторожен - там зона повышенной радиации, но говорят, можно найти ценные компоненты.'",
            wastelandInfoFail: "'Не до разговоров мне сейчас.'",
            askForAntennaHelp: "'Слушай, раз ты такой умелый с техникой Убежища... Моя радиоантенна на крыше барахлит. Если починишь, я тебя отблагодарю. Нужны кое-какие детали, наверное, металлолом да провода.'",
            antennaQuestInProgress: "'Похоже, у тебя еще не все детали. Нужно 3 металлолома и 2 единицы электроники.'",
            antennaQuestCompleted: "'Отлично! Антенна работает! Спасибо, друг. Вот, возьми это за труды. Теперь хоть новости смогу слушать... если они есть.'",
            distressSignalLead: "'Пока ты возился с антенной, я поймал странный сигнал. Очень слабый, но похож на просьбу о помощи. Шел откуда-то с [Направление, например, северо-запада]. Может, проверишь? В одиночку в Пустоши долго не протянешь.'" // Для нового квеста
        }
    },

    terminalSuccessMessages: {
        vaultDoorTerminal: "Протокол открытия двери Убежища активирован... Массивная дверь со скрежетом отходит в сторону, открывая путь наружу.",
        redRocketTerminal: "Доступ к системе безопасности 'Красной Ракеты'... Деактивация ловушек на складе... Готово. Открыт доступ к небольшому тайнику с припасами.",
        overseerTerminalAccess: "Доступ к терминалу Смотрителя получен. Открыты файлы: [ЛИЧНЫЙ ЖУРНАЛ], [ПРОТОКОЛЫ БЕЗОПАСНОСТИ УБЕЖИЩА], [ДАННЫЕ О ВНЕШНЕМ МИРЕ - ПОВРЕЖДЕНЫ]." // Новое сообщение
    },

    holodiskContents: {
        "overseer_note_01": {
            title: "Запись Смотрителя Убежища 76 - День 0",
            content: [
                "Журнал Смотрителя, запись 001.",
                "Сегодня День Возрождения. Или должен был быть. Что-то пошло не так с автоматическим протоколом открытия. Дверь осталась запечатанной.",
                "Связи с Волт-Тек нет. Внутренние системы пока работают, но ресурсы не бесконечны.",
                "Я активировал резервный протокол доступа к главному терминалу. Если кто-то это читает, значит, я уже не смог... или смог, но вы все равно здесь.",
                "Пароль к терминалу должен быть связан с нашей миссией... или с тем, что нас оберегает. Попробуйте что-то простое, связанное с безопасностью или нашей задачей. Например, имя нашей корпорации или цель Убежища.",
                "Удачи. И да сохранит нас всех... что бы там ни было наверху."
            ].join('\n')
        },
        "scavenger_log_01": {
            title: "Дневник Мусорщика - Запись 3",
            content: [
                "Третий день в руинах Спрингвейла. Радиация достает, но пока терпимо. Нашел немного консервов в старом маркете.",
                "Слышал выстрелы со стороны старой электростанции. Кажется, там опять рейдеры или супермутанты что-то не поделили.",
                "Говорят, на электростанции можно найти силовые ячейки, если повезет и не нарвешься на охрану. Но туда лучше соваться хорошо подготовленным. Я видел, как один смельчак не вернулся.",
                "Пойду проверю старую заправку 'Красная Ракета', может, там что-то осталось из инструментов."
            ].join('\n')
        },
        "dog_collar_note": {
            title: "Записка на ошейнике",
            content: [
                "Его зовут Псина. Он хороший мальчик.",
                "Если вы нашли его одного, значит, со мной что-то случилось.",
                "Позаботьтесь о нем, пожалуйста. Он будет вам верным другом.",
                "- Дж."
            ].join('\n')
        },
        "overseer_terminal_log_personal": { // Запись из терминала Смотрителя
            title: "Личный Журнал Смотрителя - Запись 734",
            content: [
                "День Возрождения откладывается. Главный механизм двери заклинило. Автоматика не сработала. Попытки ручного открытия с главного пульта пока безуспешны. Радиационный фон снаружи... он выше ожидаемого. Гораздо выше.",
                "Запросил данные Волт-Тек о внешних условиях – тишина. Похоже, мы сами по себе. Протокол 'Одинокий Странник' может оказаться не просто формальностью.",
                "Я оставил резервный доступ к этому терминалу и сейфу. Если кто-то из персонала выживет и сможет сюда добраться, здесь есть кое-какие припасы и, возможно, последний шанс. Пароль к сейфу – год основания Волт-Тек... или был? Голова уже не та. Кажется, я записал его где-то в служебных инструкциях по безопасности...",
                "Надеюсь, хоть кто-то это прочтет. Надежда – единственное, что у нас осталось."
            ].join('\n')
        },
        "overseer_terminal_log_security": { // Запись из терминала Смотрителя
            title: "Протоколы Безопасности Убежища - Выдержка",
            content: [
                "ПРОТОКОЛ БЕЗОПАСНОСТИ 76-СИГМА:",
                "В случае отказа основного механизма открытия двери Убежища, доступ к ручному управлению может быть получен через терминал Смотрителя.",
                "Для доступа к экстренным припасам, сейф Смотрителя защищен кодом: 2077. (Стандартный код Волт-Тек для чрезвычайных ситуаций).",
                "ВНИМАНИЕ: Несанкционированный доступ к терминалу Смотрителя или сейфу будет рассматриваться как нарушение протокола высшего уровня.",
                "В случае полной потери связи с Волт-Тек, Смотритель имеет право действовать по собственному усмотрению для обеспечения выживания жителей Убежища или выполнения основной миссии."
            ].join('\n')
        }
    },

    radioStationContent: {
        news: [
            "Сообщается о возросшей активности рейдеров в районе Спрингвейла. Путникам рекомендуется соблюдать осторожность.",
            "Замечена группа супермутантов, двигающаяся на юг от старой электростанции. Будьте бдительны!",
            "Торговый караван из Ривет-Сити ожидает прибытия в Мегатонну через два дня. Цены на воду могут временно снизиться.",
            "Братство Стали патрулирует окрестности Цитадели. По слухам, они ищут довоенные технологии.",
            "Погода в ближайшие дни: переменная облачность, возможны локальные кислотные дожди. Не забывайте Антирадин!"
        ],
        vault_classics: [
            "'Волт-Тек: Мы строим будущее... Под землей!'",
            "'Не забывайте принимать ваш ежедневный Нука-Кола! Заряд бодрости на весь день!'",
            "'Улыбайтесь! Вы в Убежище – самом безопасном месте на Земле!'",
            "'Помните: Смотритель – ваш лучший друг и советчик.'",
            "'Атомы для мира! Мирные атомы для вашего дома от Дженерал Атомикс!'"
        ],
        bos_signal: [
            "Ad Victoriam! Все граждане обязаны сообщать о найденных довоенных технологиях ближайшему патрулю Братства.",
            "Только Братство Стали способно защитить человечество от опасностей технологий.",
            "Мутанты, гули, синтетики – угроза чистоте человеческой расы. Братство очистит Пустошь!",
            "Сталь несокрушима. Порядок вечен. Присоединяйтесь к Братству Стали.",
            "*помехи* ...рыцарь Торн докладывает... *помехи* ...обнаружен объект... координаты... *длинный гудок*"
        ]
    },

    companionComments: {
        dogmeat: {
            default: ["*виляет хвостом*", "*нюхает землю*", "*тихо рычит*", "*смотрит на вас с преданностью*"],
            onNewLocation: ["*осторожно обнюхивает новую территорию*"],
            vault_entrance_hall: ["*скулит, оглядываясь на дверь Убежища*"],
            overseer_office: ["*тихо рычит, обнюхивая стол Смотрителя*"], // Новый комментарий
            wasteland_near_vault: ["*осторожно нюхает воздух, поскуливает*", "Гав! (Здесь пахнет чем-то новым и опасным!)"],
            ruined_town_outskirts: ["*рычит в сторону темных руин*", "Рррр... (Кажется, там кто-то был!)"],
            springvale_store_interior: ["*обнюхивает Джо, затем успокаивается*", "(Этот человек не кажется злым...)"],
            red_rocket_station: ["*радостно лает и бегает вокруг*", "Гав-гав! (Это место ему знакомо!)"]
        }
    },

    trapDisarmMessages: {
        start_easy: "На полу натянута тонкая леска, подключенная к связке гранат. Нужно перерезать правильный проводник.",
        start_medium: "Под крышкой контейнера установлен нажимной механизм. Одно неверное движение - и взрыв.",
        start_hard: "Сложная система из нескольких датчиков движения и давления. Обезвредить будет непросто.",
        success: "Ловушка успешно обезврежена! Путь свободен / Контейнер безопасен.",
        failure_minor_damage: "Неудача! Ловушка сработала, но вам повезло отделаться легким ранением.",
        failure_major_damage: "Критическая ошибка! Взрыв! Вы серьезно ранены.",
         отказался_сработала: "Вы пытались отойти, но задели ловушку! Она сработала!",
        отказался_безопасно: "Вы осторожно отошли. Кажется, пронесло."
    }
};

function unlockPlotEntry(entryId) {
    const entry = storyTexts.plotJournalEntries.find(e => e.id === entryId);
    if (entry && !entry.unlocked) {
        entry.unlocked = true;
        if (typeof addLog === "function") {
             addLog("game", `Новая запись в сюжетном журнале: "${entry.title}"`, "item");
        }
        if (typeof updatePlotJournalDisplay === "function") {
            updatePlotJournalDisplay();
        }
    }
}

// story.js