// story.js

const storyTexts = {
    plotJournalEntries: [
        {
            id: "entry_001_awakening",
            title: "Пробуждение",
            text: "Я очнулся в Убежище 76. Сирены молчат, дверь запечатана. Что-то явно пошло не так. На главном терминале управления дверью, похоже, можно попытаться её открыть. Нужно осмотреться и найти способ выбраться.",
            unlocked: true
        },
        {
            id: "entry_002_first_steps",
            title: "Первые шаги в Пустоши",
            text: "Дверь Убежища открыта. Передо мной раскинулся чужой, враждебный мир. Радиометр на Pip-Boy трещит от радиации. Вдалеке виднеются руины какого-то городка. Нужно выяснить, что произошло и как выжить. Возможно, стоит поискать других выживших или какие-нибудь припасы.",
            unlocked: false
        },
        {
            id: "entry_003_springvale_contact",
            title: "Контакт в Спрингвейле",
            text: "В руинах Спрингвейла, в старом 'Супер-Дупер Марте', я встретил поселенца по имени Джо. Он рассказал немного о текущем положении дел - рейдеры, мутанты, радиация. Упомянул слухи о старой электростанции на севере, где могут быть ценные компоненты, но и повышенная опасность. Джо также попросил помочь с его радиоантенной, если я найду нужные детали.",
            unlocked: false
        },
        {
            id: "entry_004_dogmeat_found",
            title: "Верный Друг",
            text: "У старой заправки 'Красная Ракета' я нашел одинокую собаку. Она выглядела дружелюбной, и, кажется, готова следовать за мной. Возможно, вдвоем будет легче выжить в этой Пустоши.",
            unlocked: false
        },
        {
            id: "entry_005_antenna_repaired",
            title: "Сигнал Восстановлен",
            text: "Мне удалось починить радиоантенну Джо. Он был благодарен и немного рассказал о других поселениях. Кажется, установление связей в этом мире - ключ к выживанию. Джо стал более доверчив и намекнул на слабый сигнал бедствия.",
            unlocked: false
        },
        {
            id: "entry_006_overseer_secrets",
            title: "Тайны Смотрителя",
            text: "Терминал и сейф Смотрителя раскрыли некоторые детали о последних днях Убежища и, возможно, дали наводку на то, что произошло с автоматическим открытием двери. Похоже, Смотритель пытался предупредить о чём-то, что ждёт снаружи.",
            unlocked: false
        },
        {
            id: "entry_007_distress_signal_traced",
            title: "Сигнал Бедствия",
            text: "Джо помог мне точнее определить источник слабого сигнала бедствия. Он идёт из разрушенного маяка на восточном побережье, известного как Маяк Свечения. Там может быть кто-то, кто нуждается в помощи.",
            unlocked: false
        },
        {
            id: "entry_008_glowlight_beacon",
            title: "Маяк Свечения",
            text: "Я добрался до Маяка Свечения. Это жуткое место, окутанное легкой радиацией. Внутри обнаружил выживших, но они заперты и окружены чем-то враждебным. Им нужна помощь, чтобы выбраться.",
            unlocked: false
        },
        {
            id: "entry_009_rescue_at_beacon",
            title: "Спасение на Маяке",
            text: "Мне удалось расчистить путь и помочь выжившим с Маяка Свечения. Среди них оказалась Лиза, бывший техник Волт-Тек, которая может знать больше о причинах катастрофы. Они предложили мне убежище в своем небольшом поселении, 'Последний Рубеж'.",
            unlocked: false
        },
        {
            id: "entry_010_the_settlement_last_stand",
            title: "Последний Рубеж",
            text: "Я прибыл в 'Последний Рубеж'. Это небольшое, но хорошо укрепленное поселение. Лиза и другие жители выглядят напуганными, но полны решимости выжить. Они рассказали о нарастающей угрозе со стороны мутантов и неких 'Теней', которые похищают людей.",
            unlocked: false
        },
        {
            id: "entry_011_power_plant_investigation",
            title: "Электростанция Аркжет",
            text: "Лиза попросила меня исследовать старую электростанцию 'Аркжет' на севере. По её словам, там могут быть компоненты для восстановления какой-то довоенной технологии, которая поможет в борьбе с 'Тенями'. Она предупредила о высокой радиации и опасных мутантах.",
            unlocked: false
        },
        {
            id: "entry_012_shadows_unveiled",
            title: "Раскрытие Теней",
            text: "На электростанции 'Аркжет' я столкнулся не только с мутантами, но и с загадочными существами, названными 'Тенями'. Они быстрые, почти невидимые и невероятно опасны. Мне удалось собрать данные и компоненты, но я чувствую, что это только начало.",
            unlocked: false
        },
        {
            id: "entry_013_lisa_breakthrough",
            title: "Прорыв Лизы",
            text: "Собранные мною данные помогли Лизе совершить прорыв. Она считает, что 'Тени' - это результат неудачного эксперимента Волт-Тек, и что можно создать устройство для их отслеживания, а может быть, и для борьбы с ними. Но для этого нужны редкие ресурсы.",
            unlocked: false
        },
        {
            id: "entry_014_the_fortress_of_steel",
            title: "Крепость Стали",
            text: "Лиза указала на массивную довоенную крепость, известную как 'Стальная Твердыня', которую, по слухам, заняло Братство Стали. Она считает, что у них могут быть необходимые технологии или знания для борьбы с 'Тенями'. Это мой следующий шаг.",
            unlocked: false
        }
        // Сюда будут добавляться новые записи по мере развития сюжета
    ],

    locationDescriptions: {
        getVaultEntranceHallDescription: function(isDoorOpen) {
            if (isDoorOpen) {
                return "Главный холл Убежища 76. Дверь наружу открыта, пропуская тусклый, пыльный свет Пустоши. Через неё ощущается легкий сквозняк, несущий запахи гари и запустения. Рядом все еще стоит **терминал управления дверью** (если он не был деактивирован).";
            } else {
                return "Вы находитесь в главном холле Убежища 76. Массивная стальная дверь наружу запечатана. Рядом стоит **главный терминал управления дверью**, его экран тускло светится. В углу видна дверь в **комнату Смотрителя**.";
            }
        },
        getOverseerOfficeDescription: function(isTerminalUnlocked) {
            let desc = "Кабинет Смотрителя. Здесь царит беспорядок, будто кто-то спешно покинул это место. Повсюду разбросаны бумаги, а на столе стоит **терминал Смотрителя**. Рядом с терминалом находится **небольшой сейф**. Кажется, здесь можно найти ответы на некоторые вопросы.";
            if (isTerminalUnlocked) {
                desc += " Терминал Смотрителя доступен, открывая доступ к его личным записям и протоколам Убежища.";
            }
            return desc;
        },
        getWastelandNearVaultDescription: function() {
            return "Свежий, но пыльный воздух Пустоши ударяет в лицо. Вокруг руины и выжженная земля. Мир изменился до неузнаваемости. Радиометр на Pip-Boy показывает небольшой фон радиации. Вдалеке виднеются руины небольшого городка **Спрингвейл** на востоке. На западе виднеется контур старой **заправочной станции 'Красная Ракета'**. На горизонте на севере виднеется силуэт **старой электростанции**.";
        },
        getRedRocketDescription: function(dogFound, currentPlayer) {
            let desc = "Заброшенная заправочная станция 'Красная Ракета'. Все покрыто ржавчиной и пылью. Большинство оборудования разграблено, но, возможно, что-то еще осталось. В главном здании есть **запертый склад**.";
            if (gameLocations["red_rocket_station"].customFlags.baseFoundedHere) {
                desc = "Ваша **база на заправке 'Красная Ракета'**. Знакомое место, где можно передохнуть и заняться делами. Здесь вы чувствуете себя в безопасности.";
            } else if (!dogFound) {
                desc += " У одной из колонок сидит одинокая **немецкая овчарка** и настороженно смотрит на вас.";
            } else if (currentPlayer.companion && currentPlayer.companion.id === "dogmeat") {
                desc += " Это место теперь кажется более знакомым Псине. Он радостно виляет хвостом.";
            }
            return desc;
        },
        getSpringvaleDescription: function() {
            return "Разрушенные остатки городка **Спрингвейл**. Большинство зданий разрушены, улицы завалены обломками. В центре города возвышается старое, покосившееся здание **'Супер-Дупер Марта'**. Слышны странные звуки из глубины руин. На юге виднеется путь к разрушенному мосту.";
        },
        getSuperDuperMartDescription: function() {
            return "Интерьер старого 'Супер-Дупер Марта'. Полки пусты, товар разграблен. В воздухе витает запах пыли и затхлости. В углу у прилавка сидит **одинокий поселенец**, кажется, он что-то ищет. Касса сломана, но рядом может быть что-то интересное.";
        },
        getArcjetPowerPlantDescription: function() {
            return "Заброшенная **электростанция 'Аркжет'**. Её трубы возвышаются над горизонтом, но из них давно не идет дым. Вокруг чувствуется повышенный радиационный фон, а изнутри здания доносятся жуткие звуки. Входная дверь частично разрушена. Ощущение, что здесь произошло что-то ужасное.";
        },
        getGlowlightBeaconDescription: function(isCleared) {
            let desc = "Разрушенный **Маяк Свечения** на скалистом побережье. Его свет давно погас. Вокруг него стелется легкий, но неприятный туман, слегка фонящий радиацией. Внутри маяка слышны тихие стоны и звуки борьбы. **Дверь на вершину маяка заперта**.";
            if (isCleared) {
                desc = "Вершина **Маяка Свечения**, теперь безопасная. Отсюда открывается вид на бушующее море и далекие руины. Выжившие собрались здесь, готовясь к отбытию.";
            }
            return desc;
        },
        getLastStandSettlementDescription: function() {
            return "Небольшое, но крепко сбитое поселение, названное **'Последний Рубеж'**. Окружено импровизированными стенами из обломков. Здесь живут несколько выживших, их лица измождены, но глаза полны решимости. В центре поселения находится **главный шатер**, где, кажется, находится лидер, Лиза.";
        },
        getSteelFortressDescription: function() {
            return "Массивная довоенная крепость, известная как **'Стальная Твердыня'**. Её стены изрешечены, но всё ещё внушают уважение. Повсюду видны патрули Братства Стали в силовой броне. Огромные металлические ворота, перед которыми стоят два вооруженных рыцаря, преграждают путь. Чувствуется атмосфера строгой дисциплины.";
        }
    },

    npcDialogues: {
        joeTheSettler: {
            greeting: function(player) {
                if (player.hasItem("antenna_parts") && !player.hasQuest("repair_antenna")) { // Assuming a quest system
                     return "'Ты принес детали для антенны? Отлично!'";
                } else if (player.hasQuest("repair_antenna_completed")) {
                    return "'Привет, друг! Рад тебя видеть. Есть новости?'";
                }
                return "'Еще один из Убежища? Чем могу помочь?'";
            },
            aboutPlace: "'Это Спрингвейл... вернее, то, что от него осталось. Я тут пытаюсь выжить. Иногда приходят рейдеры, иногда мутанты. Жизнь, одним словом.'",
            tradeOffer: "'У меня мало чего есть, но можем посмотреть... В основном, это хлам, что я нашел.'",
            wastelandInfoSuccess: "'Ох, парень... тут опасно. Рейдеры, мутанты, радиация повсюду. Держи ухо востро. Если пойдешь на север, к старой электростанции, будь особенно осторожен - там зона повышенной радиации, но говорят, можно найти ценные компоненты. А на востоке, у побережья, есть старый маяк, Маяк Свечения, там тоже что-то неладное творится, но я стараюсь держаться подальше.'",
            wastelandInfoFail: "'Не до разговоров мне сейчас. Слишком опасно.'",
            askForAntennaHelp: "'Слушай, раз ты такой умелый с техникой Убежища... Моя радиоантенна на крыше барахлит. Если починишь, я тебя отблагодарю. Нужны кое-какие детали, наверное, металлолом да провода. Думаю, **3 куска металлолома** и **2 единицы электроники** хватит. Я видел, как рейдеры тащили что-то похожее в своем лагере к западу отсюда.'",
            antennaQuestInProgress: "'Похоже, у тебя еще не все детали. Нужно **3 металлолома** и **2 единицы электроники**. Поспеши, мне нужно знать, что происходит.'",
            antennaQuestCompleted: "'Отлично! Антенна работает! Спасибо, друг. Вот, возьми это за труды. Теперь хоть новости смогу слушать... если они есть. *Джо кивает в сторону Pip-Boy игрока* К слову, пока ты возился с антенной, я поймал странный сигнал. Очень слабый, но похож на просьбу о помощи. Шел откуда-то с востока, из района **Маяка Свечения**. Может, проверишь? В одиночку в Пустоши долго не протянешь.'",
            postAntennaHelp: "'Слушай, а ты слышал что-нибудь о Братстве Стали? Говорят, они засели в старой крепости на западе. У них там, должно быть, целая армия и куча довоенных технологий. Может, они что-то знают о том, что случилось с миром...'"
        },
        lisaTheTechnician: {
            greeting: "'Я Лиза. Спасибо, что помог нам выбраться оттуда. Ты герой. Мы направляемся в наше поселение, 'Последний Рубеж'. Там безопаснее. Хочешь присоединиться?'",
            aboutLastStand: "'Это наш дом. Мы построили его сами. Тут не роскошно, но безопасно. Пока. Мы постоянно сталкиваемся с мутантами и... кое-чем похуже.'",
            aboutShadows: "'Нас преследуют 'Тени'. Они появляются из ниоткуда, быстрые, почти невидимые. Забирают людей, оставляя после себя лишь страх. Я думаю, это результат какого-то довоенного эксперимента. Может быть, Волт-Тек. Если я найду подходящие компоненты, я смогу создать устройство, чтобы их отслеживать, а может, и бороться с ними. Я слышала, на **электростанции Аркжет** на севере, там, где радиация сильная, могут быть нужные мне высокотехнологичные детали. Это очень опасно, но это наш единственный шанс.'",
            arcjetQuestInProgress: "'Ты уже нашел что-нибудь на электростанции Аркжет? Мне нужны **3 высокочастотных конденсатора** и **1 ядро реактора**. Это очень важно!'",
            arcjetQuestCompleted: "'Невероятно! Ты принес то, что нужно! Теперь у меня есть шанс. Дай мне немного времени. Это может изменить всё.'",
            afterArcjetBreakthrough: "'У меня получилось! Данные и компоненты, что ты принес, помогли мне понять больше о 'Тенях'. Они... это не мутанты. Это **антиматериальные проекции**, результат сбоя в каком-то секретном проекте Волт-Тек, который должен был... я не знаю что. Но я могу создать **Детектор Теней**. Он будет их показывать, даже если они невидимы. Но мне нужна мощная антенна, чтобы его усилить. Говорят, у **Братства Стали** в их крепости, **Стальной Твердыне** на западе, есть оборудование, которое может помочь. И, возможно, они знают больше об этом проекте Волт-Тек.'",
            tradeOffer: "'У меня есть немного припасов, которые мы смогли собрать. Если тебе что-то нужно, давай посмотрим.'",
            farewell: "'Удачи тебе в Пустоши! И возвращайся, если что.'"
        },
        knightRhys: { // Новый NPC
            greeting: "'Именем Братства Стали, назовите себя, Пустошник! Цель вашего прибытия к Стальной Твердыне?'",
            aboutBrotherhood: "'Мы - Братство Стали. Защитники человечества, хранители довоенных технологий. Мы очищаем Пустошь от ереси и хаоса. Без нас мир бы погрузился во тьму.'",
            aboutTechnology: "'Технологии – это мощь. Но и величайшая опасность. Мы контролируем их, чтобы они не уничтожили нас, как это произошло однажды.'",
            onShadows: "''Тени', говоришь? Мы слышали слухи. Невидимые угрозы... Звучит как довоенное безобразие. Братство расследует подобные аномалии. Если у тебя есть **доказательства или высокотехнологичные данные**, которые могут помочь, Рыцарь Данс может быть заинтересован. Он находится в **Главном Зале Крепости**.'",
            tradeOffer: "'У Братства нет нужды в торговле с посторонними. Наше имущество предназначено для нашей миссии.'",
            farewell: "'Ad Victoriam!'"
        },
        scribeHaylen: { // Новый NPC
            greeting: "'Приветствую, путник. Я Писец Хейлен. Могу я чем-то помочь?'",
            aboutScribes: "'Мы, Писцы, - это мозг Братства. Мы исследуем, каталогизируем и сохраняем знания довоенного мира. Это наш долг перед будущим.'",
            onVault76: "'Убежище 76... любопытно. Мы знаем, что это было одно из первых убежищ, построенных по проекту 'Возрождение'. Но информации о нем крайне мало. Вы, как выходец оттуда, могли бы нам многое рассказать.'",
            knowledgeExchange: "'Если у вас есть какие-либо **холодиски или записи из Убежища 76**, которые могут содержать данные о довоенных технологиях или проектах, Братство готово вознаградить вас за них. Мы также можем поделиться некоторыми нашими знаниями, если вы докажете свою ценность.'",
            farewell: "'Пусть знания освещают ваш путь.'"
        }
    },

    terminalSuccessMessages: {
        vaultDoorTerminal: "Протокол открытия двери Убежища активирован... Массивная дверь со скрежетом отходит в сторону, открывая путь наружу. *Новая запись в журнале: 'Первые шаги в Пустоши'.*",
        redRocketTerminal: "Доступ к системе безопасности 'Красной Ракеты'... Деактивация ловушек на складе... Готово. Открыт доступ к небольшому тайнику с припасами. *Вы находите: 3 единицы патронов 10мм, 1 стимулятор, 2 чистых воды.*",
        overseerTerminalAccess: "Доступ к терминалу Смотрителя получен. Открыты файлы: **[ЛИЧНЫЙ ЖУРНАЛ]**, **[ПРОТОКОЛЫ БЕЗОПАСНОСТИ УБЕЖИЩА]**, **[ДАННЫЕ О ВНЕШНЕМ МИРЕ - ПОВРЕЖДЕНЫ]**. *Новая запись в журнале: 'Тайны Смотрителя'.*",
        arcjetTerminalAccess: "Доступ к терминалу электростанции 'Аркжет' получен. Загружены схемы реактора и данные о энергетических полях. **[Высокочастотные конденсаторы]** и **[Ядро реактора]** отмечены на карте. Осторожно, вокруг активные Тени!",
        steelFortressDatabase: "Доступ к базе данных Братства Стали получен. Информация об исследованиях довоенных технологий, включая проект 'Сумеречная Тень' Волт-Тек, который, возможно, связан с 'Тенями'. Координаты нескольких исследовательских центров Волт-Тек также доступны."
    },

    holodiskContents: {
        "overseer_note_01": {
            title: "Запись Смотрителя Убежища 76 - День 0",
            content: [
                "Журнал Смотрителя, запись 001.",
                "Сегодня День Возрождения. Или должен был быть. Что-то пошло не так с автоматическим протоколом открытия. Дверь осталась запечатанной.",
                "Связи с Волт-Тек нет. Внутренние системы пока работают, но ресурсы не бесконечны.",
                "Я активировал резервный протокол доступа к главному терминалу. Если кто-то это читает, значит, я уже не смог... или смог, но вы все равно здесь.",
                "Пароль к терминалу должен быть связан с нашей миссией... или с тем, что нас оберегает. Попробуйте что-то простое, связанное с безопасностью или нашей задачей. Например, имя нашей корпорации или цель Убежища: **Волт-Тек**.",
                "Удачи. И да сохранит нас всех... что бы там ни было наверху."
            ].join('\n')
        },
        "scavenger_log_01": {
            title: "Дневник Мусорщика - Запись 3",
            content: [
                "Третий день в руинах Спрингвейла. Радиация достает, но пока терпимо. Нашел немного консервов в старом маркете.",
                "Слышал выстрелы со стороны старой электростанции. Кажется, там опять рейдеры или супермутанты что-то не поделили.",
                "Говорят, на электростанции можно найти **силовые ячейки** и другие ценные компоненты, если повезет и не нарвешься на охрану. Но туда лучше соваться хорошо подготовленным. Я видел, как один смельчак не вернулся.",
                "Пойду проверю старую заправку 'Красная Ракета', может, там что-то осталось из инструментов."
            ].join('\n')
        },
        "dog_collar_note": {
            title: "Записка на ошейнике",
            content: [
                "Его зовут Псина. Он хороший мальчик.",
                "Если вы нашли его одного, значит, со мной что-то случилось.",
                "Позаботьтесь о нем, пожалуйста. Он будет вам верным другом.",
                "- Дж. (Возможно, Джерри из соседней фермы. На его ферме, кстати, были инструменты.)"
            ].join('\n')
        },
        "overseer_terminal_log_personal": {
            title: "Личный Журнал Смотрителя - Запись 734",
            content: [
                "День Возрождения откладывается. Главный механизм двери заклинило. Автоматика не сработала. Попытки ручного открытия с главного пульта пока безуспешны. Радиационный фон снаружи... он выше ожидаемого. Гораздо выше.",
                "Запросил данные Волт-Тек о внешних условиях – тишина. Похоже, мы сами по себе. Протокол 'Одинокий Странник' может оказаться не просто формальностью.",
                "Я оставил резервный доступ к этому терминалу и сейфу. Если кто-то из персонала выживет и сможет сюда добраться, здесь есть кое-какие припасы и, возможно, последний шанс. Пароль к сейфу – год основания Волт-Тек... или был? Голова уже не та. Кажется, я записал его где-то в служебных инструкциях по безопасности...",
                "Надеюсь, хоть кто-то это прочтет. Надежда – единственное, что у нас осталось. (Найдена записка 'Протоколы Безопасности Убежища' в другом файле терминала.)"
            ].join('\n')
        },
        "overseer_terminal_log_security": {
            title: "Протоколы Безопасности Убежища - Выдержка",
            content: [
                "ПРОТОКОЛ БЕЗОПАСНОСТИ 76-СИГМА:",
                "В случае отказа основного механизма открытия двери Убежища, доступ к ручному управлению может быть получен через терминал Смотрителя.",
                "Для доступа к экстренным припасам, сейф Смотрителя защищен кодом: **2077**. (Стандартный код Волт-Тек для чрезвычайных ситуаций).",
                "ВНИМАНИЕ: Несанкционированный доступ к терминалу Смотрителя или сейфу будет рассматриваться как нарушение протокола высшего уровня.",
                "В случае полной потери связи с Волт-Тек, Смотритель имеет право действовать по собственному усмотрению для обеспечения выживания жителей Убежища или выполнения основной миссии."
            ].join('\n')
        },
        "distress_beacon_log": { // Новый холодиск
            title: "Запись с Маяка Свечения - 2077/10/24",
            content: [
                "Это Лиза. Нас окружили... они... эти тени. Они быстрые, почти невидимые. Уже забрали нескольких. Маяк заперт, но мы не можем долго продержаться. Нужна помощь! Любой, кто слышит, пожалуйста, помогите! Мы на Маяке Свечения, восточное побережье... *Помехи* ...они внутри... *Крик*..."
            ].join('\n')
        },
        "arcjet_research_log": { // Новый холодиск
            title: "Исследовательский Журнал Аркжет - Проект 'Сумеречная Тень'",
            content: [
                "Отчёт 005. Эксперименты по созданию антиматериальных проекций продолжаются. Нестабильность энергии остаётся проблемой. Объекты 'Тень' проявляют неконтролируемую агрессию.",
                "Отчёт 012. Проекции стали просачиваться через барьеры. Наши меры безопасности неэффективны. Необходимы более мощные **высокочастотные конденсаторы** и **ядро реактора** для стабилизации поля. Если это не сработает... Мы все обречены.",
                "Отчёт 015. Сбой. Проекции вырвались. Персонал эвакуирован. Оставлено сообщение для Волт-Тек о необходимости полной деактивации и изоляции зоны. Этот проект... это был провал."
            ].join('\n')
        },
        "brotherhood_intel_shadows": { // Новый холодиск
            title: "Разведданные Братства Стали: Сумеречная Тень",
            content: [
                "Обнаружены аномальные энергетические следы в районе бывшей электростанции 'Аркжет'. Предварительный анализ указывает на высокотехнологичное, довоенное происхождение. Похоже на реализацию проекта 'Сумеречная Тень' Волт-Тек.",
                "Проект 'Сумеречная Тень' был засекреченным проектом по созданию бесшумных, невидимых оперативников. Результат, по-видимому, был катастрофическим: неконтролируемые антиматериальные сущности, способные перемещаться между измерениями. Опасность: Красная.",
                "Необходимы дальнейшие исследования. Писец Хейлен и Рыцарь Данс собирают информацию. Любые данные, касающиеся проекта, имеют высший приоритет."
            ].join('\n')
        }
    },

    radioStationContent: {
        news: [
            "Сообщается о возросшей активности рейдеров в районе Спрингвейла. Путникам рекомендуется соблюдать осторожность.",
            "Замечена группа супермутантов, двигающаяся на юг от старой электростанции. Будьте бдительны!",
            "Торговый караван из Ривет-Сити ожидает прибытия в Мегатонну через два дня. Цены на воду могут временно снизиться.",
            "Братство Стали патрулирует окрестности Цитадели. По слухам, они ищут довоенные технологии, особенно связанные с энергетическими аномалиями.",
            "Погода в ближайшие дни: переменная облачность, возможны локальные кислотные дожди. Не забывайте Антирадин!",
            "Слухи о невидимых существах, похищающих людей на восточном побережье, набирают обороты. Местные жители называют их 'Тенями'."
        ],
        vault_classics: [
            "'Волт-Тек: Мы строим будущее... Под землей!'",
            "'Не забывайте принимать ваш ежедневный Нука-Кола! Заряд бодрости на весь день!'",
            "'Улыбайтесь! Вы в Убежище – самом безопасном месте на Земле!'",
            "'Помните: Смотритель – ваш лучший друг и советчик.'",
            "'Атомы для мира! Мирные атомы для вашего дома от Дженерал Атомикс!'"
        ],
        bos_signal: [
            "Ad Victoriam! Все граждане обязаны сообщать о найденных довоенных технологиях ближайшему патрулю Братства, особенно о любых аномальных энергетических проявлениях.",
            "Только Братство Стали способно защитить человечество от опасностей технологий, выпущенных на свободу безумцами довоенного мира.",
            "Мутанты, гули, синтетики – угроза чистоте человеческой расы. Братство очистит Пустошь!",
            "Сталь несокрушима. Порядок вечен. Присоединяйтесь к Братству Стали.",
            "*помехи* ...рыцарь Торн докладывает... *помехи* ...обнаружен объект 'Сумеречная Тень'... координаты... *длинный гудок*"
        ]
    },

    companionComments: {
        dogmeat: {
            default: ["*виляет хвостом*", "*нюхает землю*", "*тихо рычит*", "*смотрит на вас с преданностью*", "*ложится у ваших ног*"],
            onNewLocation: ["*осторожно обнюхивает новую территорию*", "Гав! (Здесь пахнет чем-то необычным!)"],
            vault_entrance_hall: ["*скулит, оглядываясь на дверь Убежища*", "Ррр... (Ему не нравится запах убежища)"],
            overseer_office: ["*тихо рычит, обнюхивая стол Смотрителя*", "Ррррр... (Здесь что-то не так...)"],
            wasteland_near_vault: ["*осторожно нюхает воздух, поскуливает*", "Гав! (Здесь пахнет чем-то новым и опасным!)", "*гоняет радтаракана*"],
            ruined_town_outskirts: ["*рычит в сторону темных руин*", "Рррр... (Кажется, там кто-то был!)", "*скулит, глядя на разрушения*"],
            springvale_store_interior: ["*обнюхивает Джо, затем успокаивается*", "(Этот человек не кажется злым...)"],
            red_rocket_station: ["*радостно лает и бегает вокруг*", "Гав-гав! (Это место ему знакомо!)", "*ищет старые кости*"],
            arcjet_power_plant: ["*громко скулит и прячется за вами*", "РРРРЫЫЫЫ!!!! (Чует Тени! Чует опасность!)", "*его шерсть встаёт дыбом*"],
            glowlight_beacon: ["*нервно поскуливает, глядя на маяк*", "Гав-гав-гав! (Там кто-то есть! И он напуган!)", "*пытается просунуть нос под дверь*"],
            last_stand_settlement: ["*расслабляется и обнюхивает жителей*", "*радостно лает, будто нашел свой дом*"],
            steel_fortress: ["*рычит на солдат в силовой броне, затем прячется за ваши ноги*", "Ррр... (Они слишком большие и шумные...)"]
        }
    },

    trapDisarmMessages: {
        start_easy: "На полу натянута тонкая леска, подключенная к связке гранат. Нужно перерезать правильный проводник.",
        start_medium: "Под крышкой контейнера установлен нажимной механизм. Одно неверное движение - и взрыв.",
        start_hard: "Сложная система из нескольких датчиков движения и давления. Обезвредить будет непросто. Нужны специальные инструменты.",
        success: "Ловушка успешно обезврежена! Путь свободен / Контейнер безопасен. *Вы получаете опыт.*",
        failure_minor_damage: "Неудача! Ловушка сработала, но вам повезло отделаться легким ранением. (-10 ОЗ)",
        failure_major_damage: "Критическая ошибка! Взрыв! Вы серьезно ранены. (-30 ОЗ) *Вам может понадобиться медицинская помощь.*",
        отказался_сработала: "Вы пытались отойти, но задели ловушку! Она сработала! (-15 ОЗ)",
        отказался_безопасно: "Вы осторожно отошли. Кажется, пронесло. Ловушка осталась на месте."
    }
};

function unlockPlotEntry(entryId) {
    const entry = storyTexts.plotJournalEntries.find(e => e.id === entryId);
    if (entry && !entry.unlocked) {
        entry.unlocked = true;
        if (typeof addLog === "function") {
             addLog("game", `Новая запись в сюжетном журнале: "${entry.title}"`, "item");
        }
        if (typeof updatePlotJournalDisplay === "function") { // Assuming a UI update function
            updatePlotJournalDisplay();
        }
        return true; // Indicate successful unlock
    }
    return false; // Entry already unlocked or not found
}

// Global variable to hold game state (for demonstration, normally in game.js)
const gameLocations = {
    "vault_entrance_hall": { customFlags: { isDoorOpen: false } },
    "red_rocket_station": { customFlags: { dogFound: false, baseFoundedHere: false } },
    "overseer_office": { customFlags: { isTerminalUnlocked: false, isSafeOpen: false } },
    "glowlight_beacon": { customFlags: { isCleared: false, distressCallCompleted: false } },
    "arcjet_power_plant": { customFlags: { investigated: false } },
    "steel_fortress": { customFlags: { accessed: false } },
    // Add other locations as needed
};

// Placeholder for player object (normally in game.js)
const currentPlayer = {
    companion: null,
    hasItem: function(itemId) {
        // Placeholder: check player inventory
        return false;
    },
    hasQuest: function(questId) {
        // Placeholder: check active/completed quests
        return false;
    },
    addItem: function(itemId, quantity) {
        // Placeholder: add item to inventory
        console.log(`Added ${quantity} of ${itemId} to inventory.`);
    },
    loseHealth: function(amount) {
        // Placeholder: player loses health
        console.log(`Player lost ${amount} health.`);
    }
};

// Placeholder functions for logging and UI (normally in ui.js or game.js)
function addLog(type, message, category) {
    console.log(`[${type.toUpperCase()}] ${message}`);
}

function updatePlotJournalDisplay() {
    console.log("Plot journal display updated.");
}

// Example usage of unlockPlotEntry (for testing purposes)
// unlockPlotEntry("entry_002_first_steps");
// unlockPlotEntry("entry_006_overseer_secrets");
